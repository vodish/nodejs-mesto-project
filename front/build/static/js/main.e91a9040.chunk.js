(this.webpackJsonpweb_canonicals_ru=this.webpackJsonpweb_canonicals_ru||[]).push([[0],{19:function(e,t,a){},29:function(e,t,a){},30:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),c=a(13),o=a.n(c),r=(a(19),a(2)),i=a(7),l=a.p+"static/media/logo.0863e5bc.svg",p=a(0);var u=function(e){let{onSignOut:t,email:a}=e;return Object(p.jsxs)("header",{className:"header page__section",children:[Object(p.jsx)("img",{src:l,alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f \u043f\u0440\u043e\u0435\u043a\u0442\u0430 Mesto",className:"logo header__logo"}),Object(p.jsx)(r.b,{exact:!0,path:"/",children:Object(p.jsxs)("div",{className:"header__wrapper",children:[Object(p.jsx)("p",{className:"header__user",children:a}),Object(p.jsx)("button",{className:"header__logout",onClick:function(){t()},children:"\u0412\u044b\u0439\u0442\u0438"})]})}),Object(p.jsx)(r.b,{path:"/signup",children:Object(p.jsx)(i.b,{className:"header__auth-link",to:"signin",children:"\u0412\u043e\u0439\u0442\u0438"})}),Object(p.jsx)(r.b,{path:"/signin",children:Object(p.jsx)(i.b,{className:"header__auth-link",to:"signup",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"})})]})};const d=s.a.createContext();var h=function(e){let{card:t,onCardClick:a,onCardLike:n,onCardDelete:c}=e;const o={backgroundImage:"url(".concat(t.link,")")},r=s.a.useContext(d),i=t.likes.some((e=>e===r._id)),l="card__like-button ".concat(i&&"card__like-button_is-active");console.log(t.owner),console.log(r._id);const u=t.owner===r._id,h="card__delete-button ".concat(u?"card__delete-button_visible":"card__delete-button_hidden");return Object(p.jsxs)("li",{className:"places__item card",children:[Object(p.jsx)("div",{className:"card__image",style:o,onClick:function(){a(t)}}),Object(p.jsx)("button",{type:"button",className:h,onClick:function(){c(t)}}),Object(p.jsxs)("div",{className:"card__description",children:[Object(p.jsx)("h2",{className:"card__title",children:t.name}),Object(p.jsxs)("div",{className:"card__likes",children:[Object(p.jsx)("button",{type:"button",className:l,onClick:function(){n(t)}}),Object(p.jsx)("p",{className:"card__like-count",children:t.likes.length})]})]})]})};var j=function(e){let{cards:t,onEditProfile:a,onAddPlace:n,onEditAvatar:c,onCardClick:o,onCardLike:r,onCardDelete:i}=e;const l=s.a.useContext(d),u={backgroundImage:"url(".concat(l.avatar,")")};return Object(p.jsxs)("main",{className:"content",children:[Object(p.jsxs)("section",{className:"profile page__section",children:[Object(p.jsx)("div",{className:"profile__image",onClick:c,style:u}),Object(p.jsxs)("div",{className:"profile__info",children:[Object(p.jsx)("h1",{className:"profile__title",children:l.name}),Object(p.jsx)("button",{className:"profile__edit-button",type:"button",onClick:a}),Object(p.jsx)("p",{className:"profile__description",children:l.about})]}),Object(p.jsx)("button",{className:"profile__add-button",type:"button",onClick:n})]}),Object(p.jsx)("section",{className:"places page__section",children:Object(p.jsx)("ul",{className:"places__list",children:t.map((e=>Object(p.jsx)(h,{card:e,onCardClick:o,onCardLike:r,onCardDelete:i},e._id)))})})]})};var m=function(){return Object(p.jsx)("footer",{className:"footer page__section",children:Object(p.jsx)("p",{className:"footer__copyright",children:"\xa9 2021 Mesto Russia"})})};var _=function(e){let{title:t,name:a,isOpen:n,buttonText:s="\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",onSubmit:c,onClose:o,children:r}=e;return Object(p.jsx)("div",{className:"popup popup_type_".concat(a," ").concat(n?"popup_is-opened":""),children:Object(p.jsx)("div",{className:"popup__content",children:Object(p.jsxs)("form",{className:"popup__form",name:a,noValidate:!0,onSubmit:c,children:[Object(p.jsx)("button",{type:"button",className:"popup__close",onClick:o}),Object(p.jsx)("h3",{className:"popup__title",children:t}),r,Object(p.jsx)("button",{type:"submit",className:"button popup__button",children:s})]})})})};var b=function(e){let{card:t,onClose:a}=e;return Object(p.jsx)("div",{className:"popup popup_type_image ".concat(t?"popup_is-opened":""),children:Object(p.jsxs)("div",{className:"popup__content popup__content_content_image",children:[Object(p.jsx)("button",{type:"button",className:"popup__close",onClick:a}),Object(p.jsx)("img",{alt:t?t.name:"",src:t?t.link:"",className:"popup__image"}),Object(p.jsx)("p",{className:"popup__caption",children:t?t.name:""})]})})};const O=e=>e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status));var x=new class{constructor(e){this._address=e}setToken(e){this._token=e}getAppInfo(){return Promise.all([this.getCardList(),this.getUserInfo()])}getCardList(){return fetch("".concat(this._address,"/cards"),{headers:{Authorization:"Bearer ".concat(this._token)}}).then(O)}addCard(e){let{name:t,link:a}=e;return fetch("".concat(this._address,"/cards"),{method:"POST",headers:{Authorization:"Bearer ".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({name:t,link:a})}).then(O)}removeCard(e){return fetch("".concat(this._address,"/cards/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(this._token),"Content-Type":"application/json"}}).then(O)}getUserInfo(){return fetch("".concat(this._address,"/users/me"),{headers:{Authorization:"Bearer ".concat(this._token),"Content-Type":"application/json"}}).then(O)}setUserInfo(e){let{name:t,about:a}=e;return fetch("".concat(this._address,"/users/me"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({name:t,about:a})}).then(O)}setUserAvatar(e){let{avatar:t}=e;return fetch("".concat(this._address,"/users/me/avatar"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(O)}changeLikeCardStatus(e,t){return fetch("".concat(this._address,"/cards/").concat(e,"/likes"),{method:t?"PUT":"DELETE",headers:{Authorization:"Bearer ".concat(this._token),"Content-Type":"application/json"}}).then(O)}register(e,t){return fetch("".concat(this._address,"/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then(O)}login(e,t){return fetch("".concat(this._address,"/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then(O).then((e=>(this.setToken(e.token),localStorage.setItem("jwt",e.token),e)))}checkToken(e){return fetch("".concat(this._address,"/users/me"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then(O)}}("http://localhost:3011");var f=function(e){let{isOpen:t,onUpdateUser:a,onClose:n}=e;const[c,o]=s.a.useState(""),[r,i]=s.a.useState(""),l=s.a.useContext(d);return s.a.useEffect((()=>{l&&(o(l.name),i(l.about))}),[l]),Object(p.jsxs)(_,{isOpen:t,onSubmit:function(e){e.preventDefault(),a({name:c,about:r})},onClose:n,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",name:"edit",children:[Object(p.jsxs)("label",{className:"popup__label",children:[Object(p.jsx)("input",{type:"text",name:"userName",id:"owner-name",className:"popup__input popup__input_type_name",placeholder:"\u0418\u043c\u044f",required:!0,minLength:"2",maxLength:"40",pattern:"[a-zA-Z\u0430-\u044f\u0410-\u042f -]{1,}",value:c||"",onChange:function(e){o(e.target.value)}}),Object(p.jsx)("span",{className:"popup__error",id:"owner-name-error"})]}),Object(p.jsxs)("label",{className:"popup__label",children:[Object(p.jsx)("input",{type:"text",name:"userDescription",id:"owner-description",className:"popup__input popup__input_type_description",placeholder:"\u0417\u0430\u043d\u044f\u0442\u0438\u0435",required:!0,minLength:"2",maxLength:"200",value:r||"",onChange:function(e){i(e.target.value)}}),Object(p.jsx)("span",{className:"popup__error",id:"owner-description-error"})]})]})};var g=function(e){let{isOpen:t,onUpdateAvatar:a,onClose:n}=e;const c=s.a.useRef();return Object(p.jsx)(_,{isOpen:t,onSubmit:function(e){e.preventDefault(),a({avatar:c.current.value})},onClose:n,title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",name:"edit-avatar",children:Object(p.jsxs)("label",{className:"popup__label",children:[Object(p.jsx)("input",{type:"url",name:"avatar",id:"owner-avatar",className:"popup__input popup__input_type_description",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",required:!0,ref:c}),Object(p.jsx)("span",{className:"popup__error",id:"owner-avatar-error"})]})})};var N=function(e){let{isOpen:t,onAddPlace:a,onClose:n}=e;const[c,o]=s.a.useState(""),[r,i]=s.a.useState("");return Object(p.jsxs)(_,{isOpen:t,onSubmit:function(e){e.preventDefault(),a({name:c,link:r})},onClose:n,title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",name:"new-card",children:[Object(p.jsxs)("label",{className:"popup__label",children:[Object(p.jsx)("input",{type:"text",name:"name",id:"place-name",className:"popup__input popup__input_type_card-name",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",required:!0,minLength:"1",maxLength:"30",value:c,onChange:function(e){o(e.target.value)}}),Object(p.jsx)("span",{className:"popup__error",id:"place-name-error"})]}),Object(p.jsxs)("label",{className:"popup__label",children:[Object(p.jsx)("input",{type:"url",name:"link",id:"place-link",className:"popup__input popup__input_type_url",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0,value:r,onChange:function(e){i(e.target.value)}}),Object(p.jsx)("span",{className:"popup__error",id:"place-link-error"})]})]})};var v=function(e){let{onRegister:t}=e;const[a,n]=s.a.useState(""),[c,o]=s.a.useState("");return Object(p.jsx)("div",{className:"auth-form",children:Object(p.jsxs)("form",{className:"auth-form__form",onSubmit:function(e){e.preventDefault(),t({email:a,password:c})},children:[Object(p.jsxs)("div",{className:"auth-form__wrapper",children:[Object(p.jsx)("h3",{className:"auth-form__title",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(p.jsx)("label",{className:"auth-form__input",children:Object(p.jsx)("input",{type:"text",name:"email",id:"email",className:"auth-form__textfield",placeholder:"Email",onChange:e=>n(e.target.value),required:!0})}),Object(p.jsx)("label",{className:"auth-form__input",children:Object(p.jsx)("input",{type:"password",name:"password",id:"password",className:"auth-form__textfield",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",onChange:e=>o(e.target.value),required:!0})})]}),Object(p.jsxs)("div",{className:"auth-form__wrapper",children:[Object(p.jsx)("button",{className:"auth-form__button",type:"submit",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"}),Object(p.jsxs)("p",{className:"auth-form__text",children:["\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? ",Object(p.jsx)(i.b,{className:"auth-form__link",to:"/signin",children:"\u0412\u043e\u0439\u0442\u0438"})]})]})]})})};a(29);var C=function(e){let{onLogin:t}=e;const[a,n]=s.a.useState(""),[c,o]=s.a.useState("");return Object(p.jsx)("div",{className:"auth-form",children:Object(p.jsxs)("form",{className:"auth-form__form",onSubmit:function(e){e.preventDefault(),t({email:a,password:c})},children:[Object(p.jsxs)("div",{className:"auth-form__wrapper",children:[Object(p.jsx)("h3",{className:"auth-form__title",children:"\u0412\u0445\u043e\u0434"}),Object(p.jsx)("label",{className:"auth-form__input",children:Object(p.jsx)("input",{type:"text",name:"name",id:"email",className:"auth-form__textfield",placeholder:"Email",onChange:e=>n(e.target.value),required:!0})}),Object(p.jsx)("label",{className:"auth-form__input",children:Object(p.jsx)("input",{type:"password",name:"password",id:"password",className:"auth-form__textfield",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",onChange:e=>o(e.target.value),required:!0})})]}),Object(p.jsx)("button",{className:"auth-form__button",type:"submit",children:"\u0412\u043e\u0439\u0442\u0438"})]})})},k=a.p+"static/media/success-icon.b2474792.svg",y=a.p+"static/media/error-icon.32971857.svg";var S=function(e){let{isOpen:t,onClose:a,status:n}=e;const s="success"===n?k:y,c="success"===n?"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c":"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437.";return Object(p.jsx)("div",{className:"popup ".concat(t&&"popup_is-opened"),children:Object(p.jsx)("div",{className:"popup__content",children:Object(p.jsxs)("form",{className:"popup__form",noValidate:!0,children:[Object(p.jsx)("button",{type:"button",className:"popup__close",onClick:a}),Object(p.jsxs)("div",{children:[Object(p.jsx)("img",{className:"popup__icon",src:s,alt:""}),Object(p.jsx)("p",{className:"popup__status-message",children:c})]})]})})})};var w=e=>{let{component:t,...a}=e;return Object(p.jsx)(r.b,{exact:!0,children:()=>a.loggedIn?Object(p.jsx)(t,{...a}):Object(p.jsx)(r.a,{to:"./signin"})})};var T=function(){const[e,t]=s.a.useState(!1),[a,n]=s.a.useState(!1),[c,o]=s.a.useState(!1),[i,l]=s.a.useState(null),[h,O]=s.a.useState([]),[k,y]=s.a.useState({}),[T,A]=s.a.useState(!1),[L,E]=s.a.useState(""),[I,P]=s.a.useState(!1),[U,D]=s.a.useState(""),B=Object(r.g)();function q(){t(!1),n(!1),o(!1),A(!1),l(null)}return s.a.useEffect((()=>{const e=localStorage.getItem("jwt");e&&x.checkToken(e).then((t=>(console.log(t),x.setToken(e),D(t.email),P(!0),x.getAppInfo()))).then((e=>{let[t,a]=e;y(a),O(t),B.push("/")})).catch((e=>{localStorage.removeItem("jwt"),console.log(e)}))}),[B]),Object(p.jsx)(d.Provider,{value:k,children:Object(p.jsxs)("div",{className:"page__content",children:[Object(p.jsx)(u,{email:U,onSignOut:function(){localStorage.removeItem("jwt"),P(!1),B.push("/signin")}}),Object(p.jsxs)(r.d,{children:[Object(p.jsx)(w,{exact:!0,path:"/",component:j,cards:h,onEditProfile:function(){t(!0)},onAddPlace:function(){n(!0)},onEditAvatar:function(){o(!0)},onCardClick:function(e){l(e)},onCardLike:function(e){const t=e.likes.some((e=>e===k._id));x.changeLikeCardStatus(e._id,!t).then((t=>{O((a=>a.map((a=>a._id===e._id?t:a))))})).catch((e=>console.log(e)))},onCardDelete:function(e){x.removeCard(e._id).then((()=>{O((t=>t.filter((t=>t._id!==e._id))))})).catch((e=>console.log(e)))},loggedIn:I}),Object(p.jsx)(r.b,{path:"/signup",children:Object(p.jsx)(v,{onRegister:function(e){let{email:t,password:a}=e;x.register(t,a).then((e=>{E("success"),A(!0),B.push("/signin")})).catch((e=>{E("fail"),A(!0)}))}})}),Object(p.jsx)(r.b,{path:"/signin",children:Object(p.jsx)(C,{onLogin:function(e){let{email:t,password:a}=e;x.login(t,a).then((e=>{P(!0),D(t),B.push("/")})).catch((e=>{E("fail"),A(!0)}))}})})]}),Object(p.jsx)(m,{}),Object(p.jsx)(f,{isOpen:e,onUpdateUser:function(e){x.setUserInfo(e).then((e=>{y(e),q()})).catch((e=>console.log(e)))},onClose:q}),Object(p.jsx)(N,{isOpen:a,onAddPlace:function(e){x.addCard(e).then((e=>{O([e,...h]),q()})).catch((e=>console.log(e)))},onClose:q}),Object(p.jsx)(_,{title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",name:"remove-card",buttonText:"\u0414\u0430"}),Object(p.jsx)(g,{isOpen:c,onUpdateAvatar:function(e){x.setUserAvatar(e).then((e=>{y(e),q()})).catch((e=>console.log(e)))},onClose:q}),Object(p.jsx)(b,{card:i,onClose:q}),Object(p.jsx)(S,{isOpen:T,onClose:q,status:L})]})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(p.jsx)(s.a.StrictMode,{children:Object(p.jsx)(i.a,{children:Object(p.jsx)(T,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>{e.unregister()})).catch((e=>{console.error(e.message)}))}},[[30,1,2]]]);
//# sourceMappingURL=main.e91a9040.chunk.js.map